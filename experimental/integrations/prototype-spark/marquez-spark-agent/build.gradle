/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.6.1/userguide/java_library_plugin.html
 */

plugins {
    // Apply the java-library plugin to add support for Java Library
    id 'java-library'
    id 'com.github.johnrengelman.shadow' version '6.0.0'
}

java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}


repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
    mavenLocal()
}

dependencies {
    implementation 'org.javassist:javassist:3.20.0-GA'
//    implementation 'io.github.marquezproject:marquez-java:0.4.3'
    testCompile 'org.apache.spark:spark-core_2.11:2.4.7'
    compileOnly 'org.apache.spark:spark-core_2.11:2.4.7'
    testCompile 'org.apache.spark:spark-sql_2.11:2.4.7'
    compileOnly 'org.apache.spark:spark-sql_2.11:2.4.7'

    compileOnly group: 'org.projectlombok', name: 'lombok', version: '1.18.16'
    compile group: 'org.apache.httpcomponents.client5', name: 'httpclient5', version: '5.0.3'
    compile group: 'net.bytebuddy', name: 'byte-buddy-agent', version: '1.10.19'
    compile group: 'net.bytebuddy', name: 'byte-buddy-dep', version: '1.10.19'
    compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.12.0'
    compile group: 'com.fasterxml.jackson.core', name: 'jackson-core', version: '2.12.0'
    compile group: 'com.fasterxml.jackson.datatype', name: 'jackson-datatype-jsr310', version: '2.12.0'

    annotationProcessor "org.projectlombok:lombok:1.18.16"

    testCompile group: 'org.mockito', name: 'mockito-core', version: '3.6.28'
    testImplementation 'junit:junit:4.13'
}

shadowJar {
    // avoid conflict with any client version of that lib
    relocate 'javassist', 'marquez.javassist'
    relocate 'com.fasterxml.jackson', 'marquez.com.fasterxml.jackson'
}

jar {
    manifest {
        attributes(
                "Premain-Class": "marquez.spark.agent.MarquezAgent",
                "Agent-Class": "marquez.spark.agent.MarquezAgent"
        )
    }
}